<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>AirCapsule</title>
    <description></description>
    <link>http://aircapsule.com</link>
    <atom:link href="http://aircapsule.com/feed.xml" rel="self" type="application/rss+xml" />
    
      <item>
        <title>Normal Mapping</title>
        <description>&lt;p&gt;The normal map generated from 3D computer graphics software is usually in tangent space. It encodes the normal vector in object face’s local coordinate. 
&lt;img src=&quot;/images/2013-11-23-normal-mapping/brick_texture_small.jpg&quot; alt=&quot;Normal map&quot; /&gt;This means that if the normal vector is perpendicular to the object surface, its value will be [0.5, 0.5, 1] which creates the bluish colour. One advantage of tangent space normal map texture is that we can transform the normal if the object’s orientation is changed.&lt;/p&gt;

&lt;p&gt;I did quite a lot of search on the internet. Most of them encourage to do the normal mapping and lighting in tangent space(I guess they use forward shading). This involves transform light and view vector into tangent space in vertex shader. For some reason, I have difficulty to visualize the tangent space(tangent coordinate system). It causes a lot of troubles during implementation and the final result is not very satisfied.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-11-23-normal-mapping/tangent_space_specular.jpg&quot; alt=&quot;Tangent space specular&quot; /&gt;
Above is the lighting calculated in tangent space. You can see the specular light(using half angle) is bended. As I said, I cannot get my head around when doing lighting in tangent space. There might be some minor issues with my calculation. I doubt the tangent space view and light vector auto interpolation after vertex shader will give the “physically” correct result.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-11-23-normal-mapping/tangent_space_normal_map.jpg&quot; alt=&quot;Tangent space normal map&quot; /&gt;
But if we enable normal map in tangent space, it is actually not too bad at least you won’t notice the bended specular. It is easy to fool the human eyes on a rough surface.&lt;/p&gt;

&lt;p&gt;Considering the deferred shading, however, requires the normal to be calculated in world or eye space anyway. Unless you want to encode the transformation matrix in the texture(every face has different transformation matrix) which transform eye and light vector into tangent space. &lt;/p&gt;

&lt;p&gt;I decided to do the normal mapping in eye space, in fragment shader. I just like placing many lights in the scene, plus I feel much easier to visualize and understand the process in eye space.&lt;/p&gt;

&lt;h1 id=&quot;tangent-space&quot;&gt;Tangent Space&lt;/h1&gt;
&lt;blockquote&gt;
  &lt;p&gt;As far as the name goes, tangent space is also known as texture space in some cases.&lt;/p&gt;

  &lt;p&gt;Tangent space is just another such coordinate system, with it’s own origin. This is the coordinate system in which the texture coordinates for a face are specified. The tangent space system will most likely vary for any two faces.&lt;/p&gt;

  &lt;p&gt;&lt;cite&gt;&lt;a href=&quot;http://www.gamasutra.com/view/feature/1515/messing_with_tangent_space.php&quot;&gt;Siddharth Hegde, Messing with Tangent Space&lt;/a&gt;&lt;/cite&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I also like to treat the tangent space as a coordinate system before model space, the model’s vertex starts in the 2D texture space(texture coordinate system) which describes how the texture pixel should be mapped to the model. Then we assign another 3D position value to the vertex defines its location in the model, which brings it into model space.&lt;/p&gt;

&lt;p&gt;We just need to construct a matrix that transform vertex from texture space into model space. From there we are free to apply other matrix which transform to world or eye space.&lt;/p&gt;

&lt;h1 id=&quot;basis-in-rotation-matrix&quot;&gt;Basis in rotation matrix&lt;/h1&gt;
&lt;p&gt;Let’s defines &lt;script type=&quot;math/tex&quot;&gt;\left[ \begin{array}{c} U \\ V \\ 1 \end{array} \right]&lt;/script&gt; which describes the vertex is mapped to the texture pixel at point &lt;script type=&quot;math/tex&quot;&gt;[U, V]&lt;/script&gt; in texture space, and &lt;script type=&quot;math/tex&quot;&gt;\left[ \begin{array}{c} X \\ Y \\ Z \end{array} \right]&lt;/script&gt; to be the vertex’s actual position in model space. We also have the basis of tangent space(unit vector): &lt;script type=&quot;math/tex&quot;&gt;T&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;N&lt;/script&gt; named &lt;strong&gt;tangent&lt;/strong&gt;, &lt;strong&gt;bitangent&lt;/strong&gt; and &lt;strong&gt;normal&lt;/strong&gt;. Now we can create a linear relation using matrix form:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\left[ \begin{array}{c} 
T_x &amp; B_x &amp; N_x \\ 
T_y &amp; B_y &amp; N_y \\ 
T_z &amp; B_z &amp; N_z
\end{array} \right]
\times
\left[ \begin{array}{c} 
U \\ 
V \\
1 
\end{array} \right]
= 
\left[ \begin{array}{c} 
X \\ 
Y \\
Z 
\end{array} \right]
 %]]&gt;&lt;/script&gt;

&lt;p&gt;It is strange to see the transform matrix is consists of basis of tangent space &lt;script type=&quot;math/tex&quot;&gt;T&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;N&lt;/script&gt; &lt;strong&gt;in relation to the model space&lt;/strong&gt;. &lt;/p&gt;

&lt;p&gt;In essence, the matrix transform is just description of a linear relationship between two vectors: how vector in model space changes while we change the vector in texture space.
&lt;img src=&quot;/images/2013-11-23-normal-mapping/axis_2.jpg&quot; alt=&quot;Axis&quot; /&gt;
The picture above describe the process. All the basis of tangent space are projected onto the model space axis &lt;script type=&quot;math/tex&quot;&gt;X&lt;/script&gt;. It is exactly the first row of the matrix &lt;script type=&quot;math/tex&quot;&gt;% &lt;![CDATA[
\left[ \begin{array}{c} T_x &amp; B_x &amp; N_x \end{array} \right] %]]&gt;&lt;/script&gt;. The multiplication to the the vector &lt;script type=&quot;math/tex&quot;&gt;\left[ \begin{array}{c} U \\ V \\ 1 \end{array} \right]&lt;/script&gt; in texture space in fact describes the linear relationship between two spaces, producing a vector lies on &lt;script type=&quot;math/tex&quot;&gt;X&lt;/script&gt; axis in model space. It is easy to understand and produce the other two vectors lies on &lt;script type=&quot;math/tex&quot;&gt;Y&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;Z&lt;/script&gt; axis, results the final model space vector.&lt;/p&gt;

&lt;h1 id=&quot;calculate-tangent-bitangent&quot;&gt;Calculate Tangent, Bitangent&lt;/h1&gt;

&lt;h1 id=&quot;basis-axis-in-2d&quot;&gt;Basis Axis in 2D&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;/images/2013-11-23-normal-mapping/axis.jpg&quot; alt=&quot;Axis&quot; /&gt;
&lt;script type=&quot;math/tex&quot;&gt;\vec{X}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\vec{Y}&lt;/script&gt; are the axis of model coordinate system, &lt;script type=&quot;math/tex&quot;&gt;\vec{T}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\vec{B}&lt;/script&gt; are axis of tangent space coordinate system. &lt;script type=&quot;math/tex&quot;&gt;\vec{p}&lt;/script&gt; is a vector in tangent space. &lt;script type=&quot;math/tex&quot;&gt;p_{t}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;p_{b}&lt;/script&gt; are the projection of &lt;script type=&quot;math/tex&quot;&gt;\vec{p}&lt;/script&gt; on the axis, scalar value.&lt;/p&gt;

&lt;p&gt;In &lt;script type=&quot;math/tex&quot;&gt;\vec{T}\vec{B}&lt;/script&gt; tangent space&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; \vec{p} = p_{t}\vec{T} + p_{b}\vec{B} &lt;/script&gt;

&lt;p&gt;&lt;script type=&quot;math/tex&quot;&gt;\vec{T}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\vec{B}&lt;/script&gt; axis can be projected onto &lt;script type=&quot;math/tex&quot;&gt;\vec{X}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\vec{Y}&lt;/script&gt; axis in model space, results &lt;script type=&quot;math/tex&quot;&gt;T_{x}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;T_{y}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;B_{x}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;B_{y}&lt;/script&gt;. Because &lt;script type=&quot;math/tex&quot;&gt;\vec{X}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\vec{Y}&lt;/script&gt; are basis vector, unit vector, we have&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\vec{T} = T_{x}\vec{X} + T_{y}\vec{Y} = T_{x} + T_{y}\\
\vec{B} = B_{x}\vec{X} + B_{y}\vec{Y} = B_{x} + B_{y}
&lt;/script&gt;

&lt;p&gt;Let &lt;script type=&quot;math/tex&quot;&gt; \vec{p}_{model\,space} &lt;/script&gt; to be the same vector &lt;script type=&quot;math/tex&quot;&gt;\vec{p}&lt;/script&gt; but in model space.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\vec{p}_{model\,space} = p_{t}(T_{x} + T_{y}) + p_{b}(B_{x} + B_{y})
&lt;/script&gt;

&lt;p&gt;Now, we’ve successfully transformed &lt;script type=&quot;math/tex&quot;&gt; \vec{p} &lt;/script&gt; into model space &lt;script type=&quot;math/tex&quot;&gt;\vec{p}_{model\,space}&lt;/script&gt;. The last step is to represent the linear equations in matrix form.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\left[ \begin{array}{c} 
p_x \\ 
p_y 
\end{array} \right] 
= 
\begin{bmatrix} 
T_x &amp; B_x \\ 
T_y &amp; B_y 
\end{bmatrix} 
\times 
\left[ \begin{array}{c} 
p_t \\ 
p_b 
\end{array} \right]
 %]]&gt;&lt;/script&gt;

&lt;p&gt;It is obvious that &lt;script type=&quot;math/tex&quot;&gt;% &lt;![CDATA[
 \begin{bmatrix} T_x &amp; B_x \\ T_y &amp; B_y \end{bmatrix}  %]]&gt;&lt;/script&gt; is the matrix we want which transforms tangent space into model space. Multiply both side by the &lt;script type=&quot;math/tex&quot;&gt; \left[ \begin{array}{c} p_t \\ p_b \end{array} \right]^{-1} &lt;/script&gt; gives you the matrix.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\left[ \begin{array}{c} 
p_x \\ 
p_y 
\end{array} \right] 
\times 
\left[ \begin{array}{c} p_t \\ p_b \end{array} \right]^{-1}
= 
\begin{bmatrix} 
T_x &amp; B_x \\ 
T_y &amp; B_y 
\end{bmatrix} 
\times 
\left[ \begin{array}{c} 
p_t \\ 
p_b 
\end{array} \right]
\times 
\left[ \begin{array}{c} p_t \\ p_b \end{array} \right]^{-1}
=
\begin{bmatrix} 
T_x &amp; B_x \\ 
T_y &amp; B_y 
\end{bmatrix} 
 %]]&gt;&lt;/script&gt;

&lt;p&gt;Note that &lt;script type=&quot;math/tex&quot;&gt;p_t&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;p_b&lt;/script&gt; can be actually treated as a vector, a vector from origin &lt;script type=&quot;math/tex&quot;&gt;O&lt;/script&gt; of the tangent space. This leads to a generalization.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\left[ \begin{array}{c} p_t - q_t \\ p_b - q_b \end{array} \right]^{-1}
&lt;/script&gt;

&lt;p&gt;Generalize to 3D&lt;/p&gt;

&lt;h1 id=&quot;tangent-space-to-eye-space&quot;&gt;Tangent Space to Eye Space&lt;/h1&gt;

&lt;p&gt;Construct the matrix transform from tangent to eye(world) space&lt;/p&gt;

&lt;h1 id=&quot;normal-decoding&quot;&gt;Normal decoding&lt;/h1&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;glsl&quot;&gt;&lt;span class=&quot;k&quot;&gt;vec3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;permuted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;texture2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bumpTexture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v_TexCoord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/images/2013-11-23-normal-mapping/per_fragment_normal_map.jpg&quot; alt=&quot;Per fragment normal map&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 23 Nov 2013 22:54:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/11/23/2013-11-23-normal-mapping/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/11/23/2013-11-23-normal-mapping/</guid>
      </item>
    
      <item>
        <title>Octopress to Jekyll</title>
        <description>&lt;p&gt;Try to get a new theme for my blog. I’m not very satisfied with Octopress’ slow update cycle, I decided to switch to the Jekyll.(Although Octopress is built on top of Jekyll) Since I’m not proficient in Ruby, it turned out to be a quite difficult job for me.&lt;/p&gt;

&lt;p&gt;Github pages does not support certain plugins probably because of security reason. I have to generate the static site locally and push it to the master branch of my blog repository.(For some reason this repository use master branch for github page, usually should be gh-pages) This means I need to maintain two branches, manually. One for the source of my blog, one for the actual html site, which is not ideal.&lt;/p&gt;

&lt;p&gt;I copied some rake task from internet and Octopress rake file for handling site generateion, deployment, post creation.&lt;/p&gt;

&lt;p&gt;It do the jobs for now. Till next time, hopefully I’ll have some proper notes for graphics programming.&lt;/p&gt;
</description>
        <pubDate>Sat, 23 Nov 2013 21:41:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/11/23/octopress-to-jekyll/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/11/23/octopress-to-jekyll/</guid>
      </item>
    
      <item>
        <title>OpenGL Transformations</title>
        <description>&lt;p&gt;Below are the common operations happened during the OpenGL rendering pipeline.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Model transform, apply model matrix.&lt;/li&gt;
  &lt;li&gt;View transform, apply View matrix.&lt;/li&gt;
  &lt;li&gt;Projection, apply projection matrix.&lt;/li&gt;
  &lt;li&gt;Divide &lt;code&gt;W&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Viewport transform, apply viewport interpolation.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The model and view transforms sometimes be combined into one ModelView transform.&lt;/p&gt;

&lt;h3 id=&quot;model-transform&quot;&gt;Model Transform&lt;/h3&gt;
&lt;p&gt;Model matrix will be constructed. The matrix transform vertex from &lt;code&gt;local space&lt;/code&gt; into &lt;code&gt;world space&lt;/code&gt; coordinate.&lt;/p&gt;

&lt;p&gt;For example, in order to create a car, you usually need a car body and 2 wheels (2D, for simplicity reason). I come from a Adobe Flash background, a display list or scene graph will be used.&lt;/p&gt;

&lt;p&gt;That means you position everything relate to something else. The 4 wheels’ position will be positioned relate to the car itself, at(2, 0) and (5, 0). The car body will be also placed related to the car at (1, 1).&lt;/p&gt;

&lt;p&gt;The positions above are all related to their parent, the car. I usually treat it as a &lt;code&gt;local space&lt;/code&gt;, this space only concern the object itself but related to its parent.&lt;/p&gt;

&lt;p&gt;Finally, we position the car at 100 metres away at (100, 0), which “group” the body and wheels and position them at (100 + 1, 0 + 1), (100 + 2, 0 + 0) and (100 + 5, 0 + 0).&lt;/p&gt;

&lt;p&gt;Now the car’s body and wheels are in the &lt;code&gt;world space&lt;/code&gt;, the root, since I do not simulate earth rotation and orbit around the sum.&lt;/p&gt;

&lt;h3 id=&quot;view-transform&quot;&gt;View transform&lt;/h3&gt;
&lt;p&gt;Just like take a picture, you can move the camera around, &lt;strong&gt;or&lt;/strong&gt; you can move the objects around! 所谓的摆拍。&lt;/p&gt;

&lt;p&gt;Move camera to the right is the same as to move all the objects in the scene to the left. Rotate camera 60 degree is the same as make all the objects orbit the camera position -60 degree.&lt;/p&gt;

&lt;p&gt;The view matrix is actually the inverse of the camera’s position and rotation matrix.&lt;/p&gt;

&lt;p&gt;Apply this view matrix to the model matrix, you end up a ModelView matrix which transform objects into &lt;code&gt;eye space&lt;/code&gt; coordinate.&lt;/p&gt;

&lt;h3 id=&quot;projection&quot;&gt;Projection&lt;/h3&gt;
&lt;p&gt;Projection matrix transform &lt;code&gt;eye space&lt;/code&gt; coordinate into &lt;code&gt;clip space&lt;/code&gt; coordinate, Where view frustum clip will be performed. Vertex outside the view frustum will be discarded and new vertex will be added to construct new triangles. Range, [-1, 1].&lt;/p&gt;

&lt;p&gt;The result is still a homogeneous coordinates.&lt;/p&gt;

&lt;h3 id=&quot;w-division&quot;&gt;W division&lt;/h3&gt;
&lt;p&gt;Divide the 4th component of the homogeneous coordinate tuple results a &lt;code&gt;normalized device coordinates&lt;/code&gt;, &lt;code&gt;ndc&lt;/code&gt; for short. The coordinate system ranges from [-1, 1]&lt;/p&gt;

&lt;h3 id=&quot;viewport-transform&quot;&gt;Viewport transform&lt;/h3&gt;
&lt;p&gt;Convert &lt;code&gt;ndc&lt;/code&gt; into &lt;code&gt;screen space&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Simple linear interpolation. [-1, 1] will be interpolated into [left, right], [bottom, top], [near, far]&lt;/p&gt;

&lt;h3 id=&quot;summary&quot;&gt;Summary&lt;/h3&gt;
&lt;p&gt;A vertex is transformed as following sequence:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;model matrix transform to &lt;code&gt;world space&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;view matrix transform to &lt;code&gt;eye space&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;projection matrix transform to &lt;code&gt;clip space&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Divide &lt;strong&gt;W&lt;/strong&gt; transform to &lt;code&gt;normalized device coordinate&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;viewport transform results &lt;code&gt;screen space&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;other-information&quot;&gt;Other information&lt;/h3&gt;

&lt;h4 id=&quot;homogeneous-coordinates&quot;&gt;Homogeneous coordinates&lt;/h4&gt;
&lt;p&gt;I’ve no idea what does &lt;strong&gt;homogeneous&lt;/strong&gt; mean. But I just need an intuition.&lt;/p&gt;

&lt;p&gt;Say, you have a point at infinite position far far away, how to represent it, (∞, ∞)? Completely useless, since I don’t know how to add or substract ∞.&lt;/p&gt;

&lt;p&gt;But remember the school teacher always said that, &lt;strong&gt;&lt;em&gt;never divide a number by 0&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;It acutally make sense in this situation, if we append a new component 0 to the 2D tuple. Say (1, 1, 0), this means a infinite point. Because (1/0, 1/0) =&amp;gt; (∞, ∞).&lt;/p&gt;

&lt;p&gt;This is call &lt;code&gt;Homogeneous coordinates&lt;/code&gt;. Quite intuitive.&lt;/p&gt;

&lt;p&gt;In OpenGL, the 3D vector usually represented as a 4 dimentional tuple, with the last element to be &lt;strong&gt;0&lt;/strong&gt;, an infinite location. Which make sense, vector does not have position, just direction. You can add two vectors and results a new vector, since the 4th components addtion also results 0.&lt;/p&gt;

&lt;p&gt;For 3D point, vertex position in OpenGL. The 4th component will be &lt;strong&gt;1&lt;/strong&gt;. (x, y, z, 1), divide by 4th component 1 still results (x, y, z) represent a physical location. But it does not make sense to add up two points together, since it 4th component become 2, an invalid tuple. Checking last component to be 2 or not can be used as a validation.&lt;/p&gt;
</description>
        <pubDate>Sun, 02 Jun 2013 09:29:00 +0100</pubDate>
        <link>http://aircapsule.com/blog/2013/06/02/opengl-transformations/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/06/02/opengl-transformations/</guid>
      </item>
    
      <item>
        <title>WebGL State Sorting</title>
        <description>&lt;p&gt;今天又思考了一下 OpenGL alpha 问题。很早之前就研究过，因为一会儿 Ruby on Rails 一会儿 Node.js，翻来覆去就忘了。&lt;/p&gt;

&lt;p&gt;Reducing OpenGL state changes is one of the several ways to optmize the performance. Sorting the objects into categories directly reduced state changes.&lt;/p&gt;

&lt;p&gt;Alpha transparency is definitely required in game. This also requires objects sorting. Opaque object must be drawn first, before translucent object.&lt;/p&gt;

&lt;h3 id=&quot;what-order&quot;&gt;What order?&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;From my understanding first of all, the objects must be transformed using &lt;code&gt;model view matrix&lt;/code&gt;, into eye coordinates.&lt;/li&gt;
  &lt;li&gt;Second, because opaque must be drawn before translucent object. Objects must be sorted into 2 categories: opaque and translucent. &lt;/li&gt;
  &lt;li&gt;Sort by other states, into categories, e.g., texture id.&lt;/li&gt;
  &lt;li&gt;Opaque objects must be sorted into &lt;code&gt;near to far&lt;/code&gt; order.&lt;/li&gt;
  &lt;li&gt;Translucent objects must be sorted into &lt;code&gt;far to near&lt;/code&gt; order.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Of course, z-order is related to the eye position, near means closer to eye.&lt;/p&gt;

&lt;h3 id=&quot;how-to-sort&quot;&gt;How to sort?&lt;/h3&gt;

&lt;p&gt;Here is a simple JavaScript code. Basically, it is a very simple &lt;a href=&quot;http://en.wikipedia.org/wiki/Insertion_sort&quot;&gt;insertion sort&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;JavaScript can use &lt;code&gt;Array.sort&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;javascript&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt;   &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt;     &lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ceil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt;     &lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt;     &lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ceil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt;   &lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sortFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sortFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;26&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;27&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;28&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;29&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;30&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;31&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;32&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;33&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;34&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;35&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;36&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;37&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;38&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;39&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;40&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;41&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;42&lt;/span&gt;   &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;translucent: &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;translucent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot; texture: &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;texture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot; z: &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;43&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;iframe style=&quot;width: 100%; height: 300px&quot; src=&quot;http://jsfiddle.net/rVzQd/embedded/result,js/light/&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;You can view the log result in the developer tool’s console.&lt;/p&gt;

&lt;p&gt;This is a very naive code, hopefully it will work in the future proper implementation. &lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/4424936/opengl-how-to-design-efficient-rendering-system-using-vertex-arrays-with-depth&quot;&gt;stackoverflow&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/4424936/opengl-how-to-design-efficient-rendering-system-using-vertex-arrays-with-depth&quot;&gt;state sorting tutorial&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 31 Mar 2013 17:05:00 +0100</pubDate>
        <link>http://aircapsule.com/blog/2013/03/31/webgl-state-sorting/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/03/31/webgl-state-sorting/</guid>
      </item>
    
      <item>
        <title>Normal Transformation</title>
        <description>&lt;p&gt;I was doing WebGL lighting which requires a special normal transformation matrix:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; (\mathbf{M}^{-1})^T &lt;/script&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;M&lt;/code&gt;&lt;/strong&gt; is a matrix, usually the model view transform matrix. I was trying to understand how they come up this matrix. Here is my understanding, a brief explanation.&lt;/p&gt;

&lt;p&gt;Below are some conditions for this problem:&lt;/p&gt;

&lt;p&gt;Let &lt;strong&gt;&lt;em&gt;&lt;code&gt;n&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; be the surface normal vector, &lt;strong&gt;&lt;em&gt;&lt;code&gt;t&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; is a vector on the surface.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;code&gt;t&#39;&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; is the vector transformed by &lt;strong&gt;&lt;code&gt;M&lt;/code&gt;&lt;/strong&gt;, the model view transform matrix. The mathmatics representation is:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; t&#39; = \mathbf{M} * t &lt;/script&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;code&gt;n&#39;&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; is vector transformed by &lt;strong&gt;&lt;code&gt;G&lt;/code&gt;&lt;/strong&gt; which is the special normal transformation matrix we need to produce. The mathmatics representation is:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; n&#39; = \mathbf{G} * n &lt;/script&gt;

&lt;p&gt;If transformed normal vector &lt;strong&gt;&lt;em&gt;&lt;code&gt;n&#39;&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; is perpendicular to the surface, by definition there will be:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; n&#39; \cdot t&#39; = (\mathbf{G} * n) \cdot (\mathbf{M} * t) = 0 &lt;/script&gt;

&lt;p&gt;Two vectors’ dot product can be rewritten into multiplication by transposing one column vector (OpenGL use column vector) into a row vector. &lt;a href=&quot;http://en.wikipedia.org/wiki/Transpose#Properties&quot;&gt;Transpose of matrix, property 6&lt;/a&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; (\mathbf{G} * n)^T * (\mathbf{M} * t) = 0 &lt;/script&gt;

&lt;p&gt;&lt;em&gt;Seems like the vectors dot product can be treated as two one dimensional matrices multiplication.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;http://en.wikipedia.org/wiki/Transpose#Properties&quot;&gt;Transpose of matrix, property 3&lt;/a&gt;. The final equation is :&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; n^T * \mathbf{G}^T * \mathbf{M} * t = 0 &lt;/script&gt;

&lt;p&gt;Now, all we need to do is using this equation to produce the normal matrix (the inverse transpose of the model view matrix).&lt;/p&gt;

&lt;p&gt;Look at the equation carefully, if &lt;strong&gt;&lt;code&gt;M&lt;/code&gt;&lt;/strong&gt; multiply transpose of &lt;strong&gt;&lt;code&gt;G&lt;/code&gt;&lt;/strong&gt; results an identity matrix &lt;strong&gt;&lt;code&gt;I&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; \mathbf{G}^T * \mathbf{M} = \mathbf{I} &lt;/script&gt;

&lt;p&gt;The equation can then be transform into&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt; n^T * t = n \cdot t = \|n\|\|t\|\cos(\frac{\pi}{2}) = 0 &lt;/script&gt;

&lt;p&gt;This is obviously true, because &lt;strong&gt;&lt;em&gt;&lt;code&gt;n&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt; is perpendicular to &lt;strong&gt;&lt;em&gt;&lt;code&gt;t&lt;/code&gt;&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;script type=&quot;math/tex&quot;&gt; \mathbf{G}^T * \mathbf{M} = \mathbf{I} &lt;/script&gt; becomes the key to solve the problem. Multiply both side by &lt;script type=&quot;math/tex&quot;&gt; \mathbf{M}^{-1} &lt;/script&gt; finally we get the answer.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\mathbf{G}^T (\mathbf{M}\mathbf{M}^{-1}) = \mathbf{I} \mathbf{M}^{-1} \Rightarrow\\

\mathbf{G}^T \mathbf{I} = \mathbf{M}^{-1}  \Rightarrow\\

\mathbf{G}^T = \mathbf{M}^{-1} \Rightarrow\\

\mathbf{G} = (\mathbf{M}^{-1})^T
&lt;/script&gt;

&lt;p&gt;This inverse transpose model view matrix must be used for surface normal transformation in order to calculate the correct lighting.&lt;/p&gt;

&lt;p&gt;This is because the model view matrix could cause the incorrect normal direction. Imagine you have a sphere, and scale 2 units only in &lt;strong&gt;&lt;code&gt;x&lt;/code&gt;&lt;/strong&gt; axis, the sphere will be stretched. If use the model view matrix, the normal points in &lt;strong&gt;&lt;code&gt;y&lt;/code&gt;&lt;/strong&gt; direction clearly will be unchanged, the length of normal in &lt;strong&gt;&lt;code&gt;x&lt;/code&gt;&lt;/strong&gt; direction is now 2 units, other normals will be incorrect as well.&lt;/p&gt;

</description>
        <pubDate>Sat, 30 Mar 2013 16:05:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/03/30/normal-transformation/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/03/30/normal-transformation/</guid>
      </item>
    
      <item>
        <title>orthogonal projection and clip space</title>
        <description>&lt;p&gt;In OpenGL clip space coordinate system is between:&lt;code&gt;[-1, 1]&lt;/code&gt;. &lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;glsl&quot;&gt;&lt;span class=&quot;k&quot;&gt;attribute&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u_resolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [0, 1] coordinate system&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a_resolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [0, 2] coordinate system&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [-1, 1] finally clip space coordinate system&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;gl_Position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However, the origin of the clip space will be end up at bottom left corner. We can flip the &lt;code&gt;y axis&lt;/code&gt; to achieve the top left origin, like Adobe Flash and other design tool.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;glsl&quot;&gt;&lt;span class=&quot;k&quot;&gt;attribute&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u_resolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [0, 1] coordinate system&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a_resolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [0, 2] coordinate system&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// [-1, 1] finally clip space coordinate system&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// flip y axis&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;gl_Position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clipSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The OpenGL use column-major matrix. Using a 4x4 matrix represent the projection:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\begin{pmatrix}
 2/width &amp; 0 &amp; 0 &amp; -1 \\
 0 &amp; -2/height &amp; 0 &amp; 1 \\
 0 &amp; 0 &amp; 2/depth &amp; -1 \\
 0 &amp; 0 &amp; 0 &amp; 1 
\end{pmatrix}
 %]]&gt;&lt;/script&gt;

&lt;p&gt;Use the above matrix in the GLSL:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt; &lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;glsl&quot;&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;attribute&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// orthogonal projection matrix&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mat4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u_pMatrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;n&quot;&gt;gl_Position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u_pMatrix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;vec4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a_position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;iframe style=&quot;width: 100%; height: 300px&quot; src=&quot;http://jsfiddle.net/nZnK4/embedded/result,html/light/&quot;&gt;&lt;/iframe&gt;
</description>
        <pubDate>Sun, 24 Mar 2013 12:05:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/03/24/orthogonal-projection-and-clip-space/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/03/24/orthogonal-projection-and-clip-space/</guid>
      </item>
    
      <item>
        <title>webgl notes</title>
        <description>&lt;h3 id=&quot;framebufferhttpgamesgreggmancomgamewebgl-image-processing-continued&quot;&gt;&lt;a href=&quot;http://games.greggman.com/game/webgl-image-processing-continued/&quot;&gt;Framebuffer&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Framebuffer is not a buffer. It is a collection of states, which has very low memory footprint. Imagine it is a C struct with lots of pointer to a real buffer, etc.&lt;/p&gt;

&lt;h3 id=&quot;renderbufferhttpstackoverflowcomquestions2213030whats-the-concept-of-and-differences-between-framebuffer-and-renderbuffer-in&quot;&gt;&lt;a href=&quot;http://stackoverflow.com/questions/2213030/whats-the-concept-of-and-differences-between-framebuffer-and-renderbuffer-in&quot;&gt;Renderbuffer&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Renderbuffer object is newly introduced for offscreen rendering. It allows to render a scene directly to a renderbuffer object, instead of rendering to a texture object. Renderbuffer is simply a data storage object containing a single image of a renderable internal format. It is used to store OpenGL logical buffers that do not have corresponding texture format, such as stencil or depth buffer.&lt;/p&gt;
</description>
        <pubDate>Sun, 24 Mar 2013 10:25:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/03/24/webgl-notes/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/03/24/webgl-notes/</guid>
      </item>
    
      <item>
        <title>Mandelbrot set and WebGL</title>
        <description>&lt;p&gt;大二的时候学过 Computer Graphics。其中某堂课作业就是要求弄个 Mandelbrot set，当时是用的 Mesa OpenGL，仿佛弄得还多轻松的。结果时隔多年今天看了一下，连复数是咋回事儿都差不多搞忘了，赶紧复习了一下，照着教程 &lt;a href=&quot;http://dev.opera.com/articles/view/raw-webgl-101-part-3-advanced-shader/&quot;&gt;advanced shader&lt;/a&gt; 做了一个: &lt;a href=&quot;http://jsfiddle.net/zUUQp/&quot;&gt;Mandelbrot set&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;方向键移动，加减号放大缩小。&lt;/p&gt;

&lt;iframe style=&quot;width: 100%; height: 300px&quot; src=&quot;http://jsfiddle.net/zUUQp/embedded/result,html/light/&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;需要支持 WebGL 的主流浏览器，Chrome, Firefox, Safari 之类的才能看得到。IE 内核的肯定没戏。&lt;/p&gt;

&lt;p&gt;这个图片核心就在这个公式: &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;f(x) = x*x + c 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上边公式里的 &lt;strong&gt;&lt;em&gt;x&lt;/em&gt;&lt;/strong&gt; 跟坐标轴没有关系，就是一个参数。&lt;/p&gt;

&lt;p&gt;而 c 才是最重要的，它是一个复数: &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;c = x + yi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这里边的 &lt;strong&gt;&lt;em&gt;x&lt;/em&gt;&lt;/strong&gt; 和 &lt;strong&gt;&lt;em&gt;y&lt;/em&gt;&lt;/strong&gt; 意思实际就是像素的坐标值。把每个像素的坐标值看成复数，带入到 &lt;strong&gt;&lt;em&gt;f(x)&lt;/em&gt;&lt;/strong&gt; 里边就可以判断该像素是不是属于 Mandelbrot set。&lt;/p&gt;

&lt;p&gt;最后这个神奇的图像的意思就是：遍历所有像素，如果该像素的 &lt;strong&gt;&lt;em&gt;f(x)&lt;/em&gt;&lt;/strong&gt; 数值趋近于 ∞ 。那么它就不在 Mandelbrot set里边，并且给它上个色（非黑色）。反过来说，黑色的像素点就表示 Mandelbrot set。&lt;/p&gt;

&lt;p&gt;如何判断该像素在 &lt;strong&gt;&lt;em&gt;f(x)&lt;/em&gt;&lt;/strong&gt; 下边是否趋近无穷？多循环几次，把前一次的结果带入下一次的 &lt;strong&gt;&lt;em&gt;f(x)&lt;/em&gt;&lt;/strong&gt; 作为参数 &lt;strong&gt;&lt;em&gt;x&lt;/em&gt;&lt;/strong&gt;，仿佛只要 &lt;strong&gt;&lt;em&gt;x^2 + y^2 &amp;gt;= 4&lt;/em&gt;&lt;/strong&gt; 都可以直接判断为 ∞ 。嗯，反正大概就是这么一回事儿……&lt;/p&gt;

&lt;p&gt;看 wikipedia 看得我一愣一愣的，整数学的人就是爱故弄玄虚，啥子 complex plane 嘛！有好“复杂”嘛！说得好高深！结果就相当于普通的 x, y 坐标系（故弄玄虚得叫笛卡儿坐标系 Cartesian coordinate system）。&lt;/p&gt;

&lt;p&gt;反正老子记不到！是我越活越蠢还是啥子喃……&lt;/p&gt;

</description>
        <pubDate>Wed, 13 Mar 2013 22:45:00 +0000</pubDate>
        <link>http://aircapsule.com/blog/2013/03/13/mandelbrot-set-and-webgl/</link>
        <guid isPermaLink="true">http://aircapsule.com/blog/2013/03/13/mandelbrot-set-and-webgl/</guid>
      </item>
    
      <item>
        <title>Install Ruby through RVM on Xcode 4.2.1 on Lion</title>
        <description>&lt;p&gt;rvm cannot compile executable, for some reasons:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;div class=&#39;bogus-wrapper&#39;&amp;gt;&amp;lt;notextile&amp;gt;&amp;lt;figure class=&#39;code&#39;&amp;gt;&amp;lt;div class=&quot;highlight&quot;&amp;gt;&amp;lt;table&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td class=&quot;gutter&quot;&amp;gt;&amp;lt;pre class=&quot;line-numbers&quot;&amp;gt;&amp;lt;span class=&#39;line-number&#39;&amp;gt;1&amp;lt;/span&amp;gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/pre&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;td class=&#39;code&#39;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;code class=&#39;&#39;&amp;gt;&amp;lt;span class=&#39;line&#39;&amp;gt;... configure: error: C compiler cannot create executables ...&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/figure&amp;gt;&amp;lt;/notextile&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/8032824/cant-install-ruby-under-lion-with-rvm-gcc-issues&quot; target=&quot;_blank&quot;&gt;This post&lt;/a&gt; magically solve the problem!&lt;/p&gt;
</description>
        <pubDate>Thu, 12 Jan 2012 00:00:00 +0000</pubDate>
        <link>http://aircapsule.com/blogs/94</link>
        <guid isPermaLink="true">http://aircapsule.com/blogs/94</guid>
      </item>
    
      <item>
        <title>Install git through Homebrew on Lion notes</title>
        <description>&lt;p&gt;I have Xcode installed already, which puts an older version of git in: &lt;strong&gt;/usr/local/bin/&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Homebrew install newer version of git at: &lt;strong&gt;/usr/local/bin/&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We have to mannally change &lt;strong&gt;$PATH&lt;/strong&gt; variable to ensure the &lt;strong&gt;/user/local/bin&lt;/strong&gt; comes before &lt;strong&gt;/usr/local/bin/&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/mxcl/homebrew/issues/6432#issuecomment-1624857&quot;&gt;https://github.com/mxcl/homebrew/issues/6432#issuecomment-1624857&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By the way, the &lt;strong&gt;$PATH&lt;/strong&gt; environment variable is loaded from this file: &lt;strong&gt;/etc/paths&lt;/strong&gt;&lt;/p&gt;
</description>
        <pubDate>Thu, 12 Jan 2012 00:00:00 +0000</pubDate>
        <link>http://aircapsule.com/blogs/91</link>
        <guid isPermaLink="true">http://aircapsule.com/blogs/91</guid>
      </item>
    
  </channel>
</rss>